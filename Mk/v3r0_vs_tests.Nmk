# Build V3R0 tests with c++ in a Microsoft VS Developer Command Prompt.

# Include this file in a makefile that includes ./v3r0_vs_build.Nmk so
# the following variables are defined:
# TOOL_CHAIN
# TOOL_CHAIN_VERSION
# CPPSTANDARD
# PATH_TO_CXX 
# COMPILER
# DPT
# DPT_VERSION
# BUILD
# V3R0
# V3R0_INC
# V3R0API_INC
# OBJS
# AFX_OBJS
# API_OBJS
# OBJECT_FILES

# V3R0 tests folders are created in ./v3r0_copy.Mk (in the Msys2 copy job).

CPP_TESTS = c++-tests
V3R0_TESTS = $(BUILD)\$(CPP_TESTS)\$(DPT_VERSION)

# Executable file names.

TEST_EXES = $(V3R0_TESTS)\api_database_services.exe \
            $(V3R0_TESTS)\create_fields.exe \
            $(V3R0_TESTS)\create_file.exe \
            $(V3R0_TESTS)\create_records.exe \
            $(V3R0_TESTS)\record_loop.exe \
            $(V3R0_TESTS)\index_loop.exe \
            $(V3R0_TESTS)\sort_loop.exe \
            $(V3R0_TESTS)\find_point.exe \
            $(V3R0_TESTS)\unsigned_short.exe \
            $(V3R0_TESTS)\create_invisible_fields.exe \
            $(V3R0_TESTS)\load_records_01.exe

# Compiler settings.

# Use settings set in ./v3r0_vs_build.Nmk except for includes.

# Build tests options for compiler.

# Drop the stdafx include.
V3R0_TESTS_INCLUDE = -I$(V3R0_INC) -I$(V3R0API_INC)

# Pattern rules V3R0 C++ tests.

# The '-Fe...\ <implied executable file name>' option must be before
# the list of actual object file names possibly built previously.
{$(CPP_TESTS)\source}.cpp{$(V3R0_TESTS)}.exe:
	@-$(CXX) $(CXXEXTRA) $(CXXFLAGS) $(V3R0_TESTS_INCLUDE) $(DEFOPTS) -Fo".\\$(V3R0_TESTS)\\" -Fe$(V3R0_TESTS)\ $< $(API_OBJS) $(OBJS)

# Build tests executables.

# objects is defined in each
# ../v3r0_vs<toolchain>_<c++ standard>_build.Nmakefile.
tests : objects $(TEST_EXES)
