# Build V3R0 tests with c++ in a Microsoft VS Developer Command Prompt.

# Include this file in a makefile that includes ./v3r0_vs_build.Nmk so
# the following variables are defined:
# TOOL_CHAIN
# TOOL_CHAIN_VERSION
# CPPSTANDARD
# PATH_TO_CXX 
# COMPILER
# DPT
# DPT_VERSION
# BUILD
# V3R0
# V3R0_INC
# V3R0API_INC
# OBJS
# AFX_OBJS
# API_OBJS
# OBJECT_FILES

# V3R0 tests folders.

BUILD_TESTS = $(BUILD)\c++-tests
V3R0_TESTS = $(BUILD_TESTS)\$(DPT_VERSION)

# Executable file names.

TEST_EXES = $(V3R0_TESTS)\api_database_services.exe \
            $(V3R0_TESTS)\create_fields.exe \
            $(V3R0_TESTS)\create_file.exe \
            $(V3R0_TESTS)\create_records.exe \
            $(V3R0_TESTS)\record_loop.exe \
            $(V3R0_TESTS)\index_loop.exe \
            $(V3R0_TESTS)\sort_loop.exe

# The build directory 'V3R0' is created in v3r0_vs_<std>_copy.Makefile.

$(BUILD_TESTS) : $(BUILD)
	mkdir $(BUILD_TESTS)

$(V3R0_TESTS) : $(BUILD_TESTS)
	mkdir $(V3R0_TESTS)

# Compiler settings.

# Use settings set in ./v3r0_vs_build.Nmk except for includes.

# Build tests options for compiler.

# Drop the stdafx include.
V3R0_TESTS_INCLUDE = -I$(V3R0_INC) -I$(V3R0API_INC)

# Pattern rules V3R0 C++ tests.

# The '-Fe...\ <implied executable file name>' option must be before
# the list of actual object file names possibly built previously.
{c++-tests\source}.cpp{$(V3R0_TESTS)}.exe:
	@-$(CXX) $(CXXEXTRA) $(CXXFLAGS) $(V3R0_TESTS_INCLUDE) $(DEFOPTS) -Fe$(V3R0_TESTS)\ $< $(API_OBJS) $(OBJS)

# Build tests executables.

# objects is defined in each
# ../v3r0_vs<toolchain>_<c++ standard>_build.Nmakefile.
tests : objects $(V3R0_TESTS) $(TEST_EXES)
